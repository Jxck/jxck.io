<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Term Dialog DEMO | labs.jxck.io</title>

<h1>Term Dialog DEMO</h1>

<style>
  dialog {
    padding: 0;
    div {
      padding: 1rem;
      background-color: cyan;
      width: 20rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;

      h1 {
        margin: 0;
      }
      section {
        height: 4rem;
        overflow: scroll;
        background-color: white;
        border: solid 1px #333;
        padding: 4px;
        p {
          padding: 0;
          margin: 0;
        }
      }
    }
  }
</style>
<dialog aria-labelledby="term">
  <div>
    <h1 id="term">Term of Service</h1>
    <section>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
      <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
      <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </section>
    <form method="dialog">
      <input type="text" name="text" value="text" />
      <input type="hidden" name="hidden" value="hidden" />
      <button type="submit" value="accept">Accept</button>
      <button type="close" value="deny">Deny</button>
    </form>
  </div>
</dialog>

<button id="show">dialog.show()</button>
<button id="showModal">dialog.showModal()</button>
<script>
  const $ = document.querySelector.bind(document)
  const $$ = document.querySelectorAll.bind(document)
  EventTarget.prototype.on = EventTarget.prototype.addEventListener
  $("dialog").showModal()

  $("#show").on("click", (e) => {
    $("dialog").show()
  })

  $("#showModal").on("click", (e) => {
    $("dialog").showModal()
  })

  $("form").on("submit", (e) => {
    e.preventDefault()
    const data = new FormData(e.target)
    console.log(new Map(data))
    const params = new URLSearchParams(data)
    $("dialog").close(params)
  })

  $("dialog").on("close", (e) => {
    console.log(e)
    console.log(e.type, e.target.returnValue)
  })

  $("dialog").on("cancel", (e) => {
    console.log(e)
    console.log(e.type, e.target.returnValue)
  })

  $("dialog").on("click", (e) => {
    // dialog 背景含めて全体がフック対象
    const { target, currentTarget } = e
    console.log({ target, currentTarget })
    if (e.target === e.currentTarget) {
       // 両方 dialog 自身なのは backdrop のみになる
      $("dialog").close()
    }
  })
</script>
