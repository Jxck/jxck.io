# [passkey][password] "Password Less" か "Less Password" か

## Intro

能登の震災から 1 年、東日本から 13 年。水害や火災も各地であり、戦火も他人事では無くなっている。

年明けに「アカウント防災訓練」を個人的に実施するようになって数年。

観点は「**今、持っているものを全て失っても、リカバリできるだろうか?**」だ。

とはいえ、現代のアカウントの管理は、リテラシーがある程度高い人間にとっても、十分に複雑になってきている。

Password Less が進む過程で、実際のところパスワードは無くなっているのではなく、減っているだけ、つまり Less Password が進んでいるだけで、最後に残るパスワードの重要性はこれまで以上に上がっているだけだという点が、無視できなくなったと感じる。

今年の成果と現状を振り返りつつ、「パスワードレスが進んだ結果、最後に守るべき影響の大きいパスワード」をどう守るかについて考えたい。


## 注意

このアカウント防災訓練は、 3/11 以降、個人的に思うところがあって行っているだけであり、特に答えを出しているつもりはない。

また、見直してみること自体はお勧めするが、ここに書くやり方を人に勧めたいわけではない。

どちらかというと「こういうのを考えるのが楽しい」からやっているのが、正直なところだ。

それを踏まえ、少しでも「あ、そういえば自分はどうなるだろう？」と思うきっかけになればと思い、今年はじめて公開してみることにした。


## 前提

アカウント管理は、結局「どうリカバリするか」に行き着く。これはサービスを提供する側も、使うユーザ側も同じだ。

パスワードを忘れたら、メールでリカバリできるかもしれない。では、そのメールのリカバリはどうなっているか？

Passkey でパスワードを無くせるかもしれない。でも Passkey を保存した iCloud にはどう入るのか？

「アレが残ってれば大丈夫」「コレがあればなんとかなる」という前提は、それが手に入る場面でしか成立しない。

災害で家や職場をすべて失い、普段使っているデバイス(PC, スマホ, Authenticator etc)をすべて失った状態でも、普段使っているサービスに再び入れるだろうか?

アカウント防災訓練を、「**ある日持っているものをすべて失ったら**」という前提で行うと、色々なものが見えてくる。


## リカバリチェーン

パスワードを忘れてリカバリする場合、メールを受信するのが一般的だろう。

そのメールが Gmail だった場合、 Google にログインできないといけない。

では、 Google へのログインはどうやってリカバリするだろう？

覚えられるようなパスワードだとまずいので、複雑なパスワードを iPhone で作った？

それを保存した iCloud にはどうやって入る？

パスワードは覚えてても、二要素認証が設定されてたら、、、それって SMS だっけ? それとも Yubikey ?

デバイスは全部失われ、印刷して机に入れておいたバックアップコードも流されていたら？

こういう連鎖を把握すると、リカバリの連鎖は割と複雑になっていることが多い。

特に、二段階/要素認証が普及した現在、覚えておいたパスワードだけで入れるサービスはどんどん減っている。

ところが、二段階/要素の選択肢が多く、フローもサービスによって異なるので、全体を把握するのはエンジニアでも難しくなってきている。

あまり意識せずに場当たり的に色々な場所に保存し、知らぬ間に複雑にしてしまっている場合もあるだろう。

最初にこの整理をし、どういうチェーンになっているかを把握すると良いだろう。

TODO: 図



## リカバリルートの特定とチェーンの整理

このチェーンを辿ったときに、最後に行き着く場所を、便宜的に「リカバリルート」と呼ぶことにしよう。

多くの場合 Google, Apple, Microsoft, 1Password などに行き着くことが多いと思う。実は、２つのサービスで相互に認証情報を保存してデットロックし得る状況になっていることもあるかもしれない。

その上で、 SMS による TOTP や、 Passkey、会社で配られた YubiKey や、銀行から送られてきた乱数表など、付随する何かを用いてる場合も多い。

登録時のバックアップコードまでちゃんと保存しているか、保存していたとしても、それが最新のものになっているかなど、普段使わないものは確認して置かないといざというとき使えないだろう。

基本的には、チェーンはシンプルな方が良い。筆者の場合は基本的に全て 1Password に保存し、1Password にさえ入れれば、ほぼ全て復旧できる状態だ。

もちろん、 1Password が SPoF で、コンプロマイズされれば終わるが、結局素人が独自で考えたオリジナルの管理方法のように、自分だけが安全だと過信した泥船に乗ることを選ばない限りは、何かしらのリカバリルートを信用するしかない。

セキュリティと可用性はトレードオフだが、多くの一般ユーザにとっては「攻撃されるリスク」よりも「ミスって詰む」リスクのほうがよっぽど高いと個人的には思っている。

また、 Google や Apple は、災害など関係なく突然垢バンされるという事例が、探すと色々出てくるだろう。仮に Google 八部に会い、 Google のサービスを使えなくなるのはしょうがないとしても、それによって他のすべてのサービスに入れなくなるのは避けたい。

また、こうしたビッグテックは、それこそ隣の島で何かあったとき、どうなるんだろう？と思ったりもする。そういう心配をするなら OSS のパスワードマネージャなどを入れるのが筋だろうが、それにしもて 1Password が便利すぎるし、一応カナダの会社だし、中の人(今は違うが)にも知り合いがいて個人的な安心感もあるので、ここにルートを預けている。


## 2FA

YubiKey や Titan のような独立した Authenticator を使う方が、 2 つ目に「所持要素」を入れる意味で理想かもしれない。しかし、流されれば終わりだ。

実際、 WebAuthn (not Passkey)が出てきた頃は、「2 つの Authenticator を買い、 1 つは普段遣い、 1 つは貸金庫に保存」なんていう話もあった。しかし、物理 Authenticator を何個か使ってきたが、割とすぐ壊れ、何度か買い直したので、バックアップとしての心もとなさを感じている。

一方 Google Authenticator などの同期のないアプリは、端末移行などでミスって詰む人を何人も見てきた。そこで、同期ができる Authy などを使っていた時期もあるが、結局これも全て 1Password に集約した。

本来なら、要素を分ける意味でパスワードと TOTP が両方 1Password に入っている状態が、理想とは言えないかもしれない。しかし、可用性を重視しているのでそれ自体は気にしていない。

代わりに、 Passkey だろうとバックアップコードだろうと、全て 1Password に入れ、実質はもう 1 要素だ。逆に 1Password の管理にだけ集中すれば良いため、認知の負荷をかなり下げることができている。

2FA は、簡単なパスワードが使い回されていた時代に、後付で「それだけでは入れなくする」目的で追加された側面が大きい。すでにパスワードマネージャで複雑なパスワードを登録し、さらに追加の要素を足しているのであれば、その時点でほとんどの攻撃に対策はできている。それでも漏れる少しの隙を防ぎたいなら、それは個々の認知の負荷と運用練度の範囲でやればいいと思う。

## 最後のパスワード

Password Less の終着点は、 Passkey の普及ではなく Password Manager の普及だろう。

そして、最後に考えないといけないのは、その Password Manager のリカバリだ。これは、 Google でも Apple でも 1Password でも、最後にはパスワードが出てくる。他に頼りにくい「ルート」であるサービスがリカバリ手段として提供できる手段は実は少なく、結局そこはパスワードを消せてないからだ。

必然的にこの「最後のパスワード」をどう守るかがリカバリの要になる。

これを失えば全部失い、コレさえあれば他のパスワードは無くせる。そういう意味で Password Less の実態は、今のところこの「最後のパスワード」に集約する Less Password なのが現状だ。

1Password の場合は、リカバリは 3 つの情報が必要だ。

1. Email
2. Secret Key
3. Password

1 と 3 は、記憶に頼ることになるだろう。特に 3 は、 1Password を使っていれば、高頻度で入れることになるため、普段使いしている筆者は記憶に頼れる。

問題は 2 だ、これは登録時に付与される 34 桁のランダム文字列であり、最初くらいしか入力しないので、記憶に頼るのは難しい。これが 1Password における「最後のパスワード」相当になる。

1Password は、この値の書かれた PDF を「Recovery Kit」として配布し、「印刷して金庫にしまっておけ」と啓蒙してくる。











パスワードを覚え、それを入れるだけなら、とりあえず覚えてさえいれば入ることができるだろう。

ある日災害に遭遇しても、無事でさえいればなんとかなるかもしれない。

しかし、複数のサービスを普通に併用する現在は、「覚えられるようなパスワードは危ない」という前提で、パスワードを無くす(Password Less)方向に進んでいる。

仮にパスワードを使っていたとしても、 SMS での TOTP や、追加の Authenticator を入れて二(段階|要素)認証を行うのが普通になった。

銀行やカードといった、災害後すぐにでも使いたいようなライフライン系は、特に力を入れている。


## Outro

今回の防災訓練は、「体が無事」という前提が実は隠れている。

それでいいのかは、直面してみないとわからない。







## Outro

deadbeef


## DEMO

動作するデモを以下に用意した。

- <https://labs.jxck.io/>


## Resources

- Spec
- Explainer
- Requirements Doc
- Mozilla Standard Position
- Webkit Position
- TAG Design Review
- Intents
- Chrome Platform Status
- WPT (Web Platform Test)
- DEMO
- Blog
- Presentation
- Issues
- Other

