# [passkey][password] アカウント防災訓練のススメ または "Password Less" と "Less Password"

## Intro

能登の震災から 1 年、東日本から 13 年。水害や火災も各地であり、戦火も他人事ではなくなっている。

年明けに「アカウント防災訓練」を個人的に実施するようになって数年。

観点は「**今、持っているものを全て失っても、リカバリできるだろうか?**」だ。

とはいえ、現代のアカウントの管理は、リテラシがある程度高い人間にとっても、十分に複雑になってきている。

Password Less が進む過程で、実際のところパスワードは無くなっているのではなく、減っているだけ、つまり Less Password が進んでいるだけで、「最後に残るパスワード」の重要性はこれまで以上に上がっているだけだという点が、無視できなくなったと感じる。

今年の成果と現状を振り返りつつ、「パスワードレスが進んだ結果、最後に守るべき影響の大きいパスワード」をどう守るかについて考えたい。


## 注意

このアカウント防災訓練は、3/11 以降、個人的に思うところがあって行っているものであり、特に答えを出しているつもりはない。

また、見直してみること自体はお勧めするが、ここに書くやり方を人に勧めたいわけではない。

どちらかというと「こういうのを考えるのが楽しい」からやっているのが、正直なところだ。

それを踏まえ、少しでも「あ、そういえば自分はどうなるだろう?」と思うきっかけになればと思い、今年初めて公開してみることにした。


## 前提

アカウント管理は、結局「どうリカバリするか」に行き着く。これはサービスを提供する側も、使うユーザ側も同じだ。

パスワードを忘れたら、メールでリカバリできるかもしれない。では、そのメールのリカバリはどうなっているか?

Passkey でパスワードを無くせるかもしれない。でも Passkey を保存した iCloud にはどう入るのか?

「アレが残っていれば大丈夫」「コレがあればなんとかなる」という前提は、それが手に入る場面でしか成立しない。

災害で家や職場をすべて失い、普段使っているデバイス(PC, スマホ, Authenticator etc)をすべて失った状態でも、普段使っているサービスに再び入れるだろうか?

アカウント防災訓練を、「**ある日持っているものをすべて失ったら**」という前提で行うと、色々なものが見えてくる。


## リカバリチェーン

パスワードを忘れてリカバリする場合、メールを受信するのが一般的だろう。

そのメールが Gmail だった場合、Google にログインできないといけない。

では、Google へのログインはどうやってリカバリするだろう?

覚えられるようなパスワードだとまずいので、複雑なパスワードを iPhone で作った?

それを保存した iCloud にはどうやって入る?

パスワードは覚えていても、二要素認証が設定されていたら、、、それって SMS だっけ? それとも Yubikey?

デバイスは全部失われ、印刷して机に入れておいたバックアップコードも流されていたら?

こういう連鎖を把握すると、リカバリの連鎖は割と複雑になっていることが多い。

特に、二段階/要素認証が普及した現在、覚えておいたパスワードだけで入れるサービスはどんどん減っている。

ところが、二段階/要素の選択肢が多く、フローもサービスによって異なるので、全体を把握するのはエンジニアでも難しくなってきている。

あまり意識せずに場当たり的に色々な場所に保存し、知らぬ間に複雑にしてしまっている場合もあるだろう。

最初にこの整理をし、どういうチェーンになっているかを把握すると良いだろう。

TODO: 図


## リカバリルートの特定とチェーンの整理

このチェーンを辿ったときに、最後に行き着く場所を、便宜的に「リカバリルート」と呼ぶことにしよう。

多くの場合、Google、Apple、Microsoft、1Password などに行き着くことが多いと思う。実は、2 つのサービスで相互に認証情報を保存してデッドロックし得る状況になっていることもあるかもしれない。

その上で、SMS による TOTP や、Passkey、会社で配られた YubiKey や、銀行から送られてきた乱数表など、付随する何かを用いている場合も多い。

登録時のバックアップコードまでちゃんと保存しているか、保存していたとしても、それが最新のものになっているかなど、普段使わないものは確認しておかないと、いざというとき使えないだろう。

基本的には、チェーンはシンプルな方が良い。筆者の場合は基本的に全て 1Password に保存し、1Password にさえ入れれば、ほぼ全て復旧できる状態だ。

もちろん、1Password が SPoF で、コンプロマイズされれば終わるが、結局素人が独自で考えたオリジナルの管理方法のように、自分だけが安全だと過信した泥船に乗ることを選ばない限りは、何かしらのリカバリルートを信用するしかない。

セキュリティと可用性はトレードオフだが、多くの一般ユーザにとっては「攻撃されるリスク」よりも「ミスって詰む」リスクのほうがよっぽど高いと個人的には思っている。

また、Google や Apple は、災害など関係なく突然アカウントが Ban されるという事例が、探すと色々出てくるだろう。仮に Google 八部に会い、Google のサービスを使えなくなるのはしょうがないとしても、それによって他のすべてのサービスに入れなくなるのは避けたい。

また、こうしたビッグテックは、それこそ隣の島で何かあったとき、どうなるんだろう?と思ったりもする。そういう心配をするなら OSS のパスワードマネージャなどを入れるのが筋だろうが、それにしても 1Password が便利すぎるし、一応カナダの会社だし、中の人(今は違うが)にも知り合いがいて個人的な安心感もあるので、ここにルートを預けている。


## 2FA

YubiKey や Titan のような独立した Authenticator を使う方が、2 つ目に「所持要素」を入れる意味で理想かもしれない。しかし、流されれば終わりだ。

実際、WebAuthn (not Passkey) が出てきた頃は、「2 つの Authenticator を買い、1 つは普段遣い、1 つは貸金庫に保存」なんていう話もあった。しかし、物理 Authenticator を何個か使ってきたが、割とすぐ壊れ、何度か買い直したので、バックアップとしての心もとなさを感じている。

一方、Google Authenticator などの同期のないアプリは、端末移行などでミスって詰む人を何人も見てきた。そこで、同期ができる Authy などを使っていた時期もあるが、結局これも全て 1Password に集約した。

本来なら、要素を分ける意味でパスワードと TOTP が両方 1Password に入っている状態が、理想とは言えないかもしれない。しかし、可用性を重視しているのでそれ自体は気にしていない。

代わりに、Passkey だろうとバックアップコードだろうと、全て 1Password に入れ、実質はもう 1 要素だ。逆に 1Password の管理にだけ集中すれば良いため、認知の負荷をかなり下げることができている。

2FA は、簡単なパスワードが使い回されていた時代に、後付けで「それだけでは入れなくする」目的で追加された側面が大きい。すでにパスワードマネージャで複雑なパスワードを登録し、さらに追加の要素を足しているのであれば、その時点でほとんどの攻撃に対策はできている。それでも漏れる少しの隙を防ぎたいなら、それは個々の認知の負荷と運用練度の範囲でやればいいと思う。


## 最後のパスワード

Password Less の終着点は、Passkey の普及ではなく Password Manager の普及だろう。

そして、最後に考えないといけないのは、その Password Manager のリカバリだ。これは、Google でも Apple でも 1Password でも、最後にはパスワードが出てくる。他に頼りにくい「ルート」であるサービスがリカバリ手段として提供できる手段は実は少なく、結局そこはパスワードを消せていないからだ。

必然的にこの「最後のパスワード」をどう守るかがリカバリの要になる。

これを失えば全部失い、これさえあれば他のパスワードは無くせる。そういう意味で Password Less の実態は、今のところこの「最後のパスワード」に集約する Less Password なのが現状だ。

1Password の場合は、リカバリには 3 つの情報が必要だ。

1. Email
2. Secret Key
3. Password

1 と 3 は、記憶に頼ることになるだろう。特に 3 は、1Password を使っていれば、高頻度で入力することになるため、普段使いしている筆者は記憶に頼れる。

問題は 2 だ。これは登録時に付与される 34 桁のランダム文字列であり、最初くらいしか入力しないので、記憶に頼るのは難しい。これが 1Password における「最後のパスワード」相当になる。

1Password は、この値の書かれた PDF を「Recovery Kit」として配布し、「印刷して金庫にしまっておけ」と啓蒙してくる。

これをどう守るか。これが最大の課題だ。


## Recovery Kit

最初に思いつくのは、先程も出た「貸金庫」だろう。

ところで貸金庫って、震災があっても無事なものなのだろうか? 3.11 後の新聞などを探すと、一応残っていたという話もあるようだが、信頼性はよくわからない。そもそも、ペライチを保存しておくには、サブスクとしてちょっと高い。

ちなみに、最近だと行員の方の信頼性の話もあるが、ペライチの紙なんかに興味はないだろうから、そこはどうでもいい。というか、そう考えると Secret Key だけが盗めてもなんにもならないので、機密性自体は重要ではなく、どちらかというとディザスタリカバリとして、「家ではない場所」に価値があるように思う。

とはいえ、関東大震災のような想定だと、もう少し遠隔地であれば良さそうだ。例えば北海道とか、海外とか。会社に支社でもあるなら、出張がてらそこにちょっと置かせてもらえれば、その方が良いかもしれない。というか、無事なオフィスがあるなら、機種変前に使ってた iPhone でも置いておきたいものだ。

まあ、被災した直後に、そんな遠くにモノを取りに行く余裕があるか怪しいし、有事でも起これば海外なんかしばらく行けない可能性もある。

物理バックアップは、ちゃんと考えると詰む。形あるものの儚さと扱いにくさを感じる。

ということで、とりあえず燃えにくいようドッグタグに Secret Key を刻み込んで、それを災害時に持ち出す防災カバンに取り付けて、物理バックアップは終わることにした。これは、「全て失ったら」の制約からは外れるが、持ち出せた場合にすぐリカバリできる用だ。


## KYC によるリカバリ

物理はこのくらいで諦めて、視点を変えてみる。

世の中には「自分が自分であること」を証明できればなんとかなる場面が少なからずある。例えば被災時には、銀行や保険は、ある程度の本人確認でサービスを受けられるようになるといった仕組みになっている。

そして、同様に一定の認証を経て公共サービスはリカバリできる、つまりマイナンバーや運転免許は、どこかのタイミングで戻ってくることになるはずだ。(被災経験がないため、実際ここがどういう運用なのかは知らないのだが)

ここまで来ると、KYC を経て登録する系のサービスは、リカバリできる可能性が高い。一般的に、登録時に免許の撮影を求めるようなサービスだ。

そして、筆者が使っている Line Mobile は、KYC が通れば同じ番号の SIM を再発行してくれる。これは、実際に問い合わせて確認した。他の SIM でも同じかは知らない。

SIM が手に入るなら、端末さえ手に入れば SMS 認証が通るということになる。

つまり、SMS は「自分が自分であること」を証明できれば、どこかのタイミングで戻ってくるリカバリ手段として使えそうだ。

一般的に、SMS はその脆弱性がよく指摘され、使わない方が良いものとされてはいる。今後は使えなくなるかもしれない。

しかし、筆者はこの性質をバックアップとして使い、記憶ベースのパスワードと SMS で認証できるサービスに、1Password の Secret Key をバックアップしている。(もちろん、それとはわからない形で)

Passkey 普及などを、リテラシを差し置いて推し進めると、自爆で入れなくなる人も少なくないだろう。そういう人のカバーのためにも、KYC でリカバリできるサービスは増えていくような気が個人的にはしている。しかし、個別にはよくても 1Password 自体が KYC ではリカバリできないため、1Hop 置いたバックアップをそのどこかに置いておくのは重要だ。もちろん、一緒に Password まで置いてはいけないのは、言うまでもない。


## その他

マイナンバーカード自体が使えないかとは思っている。今は、マイナンバーでログインできるサービスは非常に限られているが、そのどこかに任意の情報が保存できる領域があれば、市役所でマイナンバーカードを発行してもらえた時点でリカバリができる状態を作れるかもしれない。

もっと言えば、一般サービスがマイナンバーカードでログインできるようになれば楽だ。中に秘密鍵があるが、鍵自体は定期的な更新で変わるため、それ自体をキーにはできないはずだ。そこで券面情報(つまりマイナンバーそのもの)を使うのは、ハードルが非常に高いはずなので難しいという認識だ。公開はされていないが、IDP の機能自体もあるようなので、それが公開されれば良いのかもしれないが、おそらく公共サービスだけなのだろう。

また、今回は「全てを失ったが、無事ではあった」という暗黙の前提だったので、いわゆる本当の生体認証なら通るかもしれない。しかし、Touch ID や Windows Hello のように、生体情報を Authenticator Unlock に使うものは多いが、本当に生体情報を登録し直接認証に使うサービスを筆者はまだ見たことがない。個人情報の問題もあって難しいのだろうが、こういう用途で使えるサービスがあったらぜひ知りたい。


## Outro

防災訓練としてはいるが、思考実験の側面も強い。

今回は自分のアカウントだけの話をしたが、家庭内 SE の役目を担っている場合、家族(特に高齢の両親など)のように、よりネットリテラシが高くない人もカバーする必要もあるかもしれない。

筆者は 3.11 のあと、本格的に 1Password 導入した頃から、この訓練を定期的に行い、そのたびに色々と更新してきた。つまり、今後もその時々のインターネットや社会状況に応じて、更新し続ける必要があるだろう。

そういうものだと思って、年に一回くらいはなんとなく気にかけてみる機会になると良いと思う。

ちなみに、筆者の最近のテーマはどちらかというと「自分が死んだときに残された家族にアカウントをどう移譲/処分してもらうか」というデジタル終活の方だ。プライバシーを守りつつ、必要なアカウントは家族が継続して使え、不要なものは処分し、誰かに継いでもらう必要があるものを移譲してもらう、などを考えると、こちらはもっと難しく、考え甲斐があって楽しい。

その話も、いずれ書いてみたい。