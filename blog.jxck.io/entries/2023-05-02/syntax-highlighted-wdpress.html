<!DOCTYPE html>
<html lang=ja>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1">

  <link rel=author    href=https://jxck.io/humans.txt>
  <link rel=manifest  href=/manifest.webmanifest>
  <link rel=alternate href=/feeds/atom.xml type=application/atom+xml title=blog.jxck.io>
  <link rel=canonical href=https://blog.jxck.io/entries/2023-05-02/syntax-highlighted-wdpress.html>

  <link rel=preload as=script href=https://www.jxck.io/assets/js/prism.js?210115_215132>
  <link rel=preload as=script href=https://www.jxck.io/assets/js/main.js?250125_005305>

  <script defer src=https://www.jxck.io/assets/js/prism.js?210115_215132></script>
  <script defer src=https://www.jxck.io/assets/js/main.js?250125_005305></script>

  <link rel=icon type=image/svg+xml sizes=any href=https://blog.jxck.io/assets/img/jxck.svg>
  <link rel=icon type=image/png sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.png>
  <link rel=icon type=image/png sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.png>
  <link rel=icon type=image/png sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.png>
  <link rel=icon type=image/png sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.png>
  <link rel=icon type=image/png sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.png>

  <link rel=icon type=image/webp sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.webp>
  <link rel=icon type=image/webp sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.webp>
  <link rel=icon type=image/webp sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.webp>
  <link rel=icon type=image/webp sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.webp>
  <link rel=icon type=image/webp sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.webp>

  <link rel=apple-touch-icon type=image/png sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.png>
  <link rel=apple-touch-icon type=image/png sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.png>
  <link rel=apple-touch-icon type=image/png sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.png>
  <link rel=apple-touch-icon type=image/png sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.png>
  <link rel=apple-touch-icon type=image/png sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.png>

  <link rel=apple-touch-icon type=image/webp sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.webp>
  <link rel=apple-touch-icon type=image/webp sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.webp>
  <link rel=apple-touch-icon type=image/webp sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.webp>
  <link rel=apple-touch-icon type=image/webp sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.webp>
  <link rel=apple-touch-icon type=image/webp sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.webp>

  <meta name=author              content=Jxck>
  <meta name=description         content="「連載するけど、代わりにコードはハイライトさせてほしい」それが Web+DB Press 編集長に俺が出した条件だった。">
  <meta name=keywords            content="web+db,book">
  <meta name=theme-color         content=#000000>

  <meta property=og:type         content=article>
  <meta property=og:url          content=https://blog.jxck.io/entries/2023-05-02/syntax-highlighted-wdpress.html>
  <meta property=og:title        content="技術書籍をシンタックスハイライトする話 | blog.jxck.io">
  <meta property=og:site_name    content=blog.jxck.io>
  <meta property=og:description  content="「連載するけど、代わりにコードはハイライトさせてほしい」それが Web+DB Press 編集長に俺が出した条件だった。">
  <meta property=og:image        content=https://blog.jxck.io/assets/img/jxck.600x600.png>

  <meta name="Hatena::Bookmark" content="nocomment">
  <link rel="author" href="http://www.hatena.ne.jp/Jxck/" />


  <script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://blog.jxck.io"
    },
    "headline": "技術書籍をシンタックスハイライトする話 | blog.jxck.io",
    "image": [
      "https://www.jxck.io/assets/img/jxck.png",
      "https://logo.jxck.io/jxck.1200x1200.png"
    ],
    "datePublished": "2023-05-02T08:00:00+08:00",
    "dateModified": "2024-11-15T08:00:00+08:00",
    "author": {
      "@type": "Person",
      "name": "Jxck",
      "image": "https://blog.jxck.io/assets/img/jxck.png"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Jxck",
      "logo": {
        "@type": "ImageObject",
        "url": "https://logo.jxck.io/jxck.120x120.png",
        "height": 120,
        "width": 120
      }
    },
    "description": "「連載するけど、代わりにコードはハイライトさせてほしい」それが Web+DB Press 編集長に俺が出した条件だった。"
  }
  </script>

  <title>技術書籍をシンタックスハイライトする話 | blog.jxck.io</title>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/body.css?240701_012822>
</head>
<body>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/header.css?230926_134917>
  <header>
    <nav>
      <ul>
        <li><a href=https://blog.jxck.io      ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/blog.svg?160301_215351   title=blog   alt="blog logo" class=logo></a>
        <li><a href=/search                   ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/search.svg?190421_130410 title=search alt=search></a>
        <li><a href=.                         ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/up.svg?160831_002319     title=up     alt="move to parent directory"></a>
        <li><a href=/feeds/atom.xml           ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/rss.svg?160227_124312    title=rss    alt="rss feed"></a>
        <li><a href=https://jxck.io/humans.txt><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/humans.svg?160831_002319 title=humans alt=huamns.txt></a>
        <li><a href=https://jxck.io           ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/jxck.svg?190123_200004   title=jxck   alt="jxck logo" class=logo></a>
      </ul>
    </nav>
  </header>

  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/markdown.css?220304_061221>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/main.css?201223_011131>
  <main>
    <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/info.css?240713_033306>
    <dl class=info>
      <div><dt>created_at</dt><dd><time class=created_at datetime=2023-05-02>2023-05-02</time></dd></div>
      <div><dt>updated_at</dt><dd><time class=updated_at datetime=2024-11-15>2024-11-15</time></dd></div>
      <div>
        <dt>tags</dt>
        <dd>
          <nav class=tags>
            <ul>
              <li><a href="/tags#web+db">web+db</a>
              <li><a href="/tags#book">book</a>
            </ul>
          </nav>
        </dd>
      </div>
      <div>
        <dt>toc</dt>
        <dd>
          <button popovertarget="toc">open</button>
          <nav id=toc popover=manual>
            <h2>ToC</h2>
            <button popovertarget="toc" popovertargetaction="hide">❌</button>
            <ol>
              <li><a href="#intro">Intro</a>
              <li><a href="#技術書籍のシンタックスハイライト">技術書籍のシンタックスハイライト</a>
              <li><a href="#webdb-の編集ツール">Web+DB の編集ツール</a>
              <li><a href="#md2indesign">md2indesign</a>
              <li><a href="#indesign-記法">InDesign 記法</a>
              <li><a href="#webdb-のハイライト">Web+DB のハイライト</a>
              <li><a href="#名物編集長">名物編集長</a>
              <li><a href="#まだ情熱はある">まだ、情熱はある</a>
              <li><a href="#outro">Outro</a>
            </ol>
          </nav>
        </dd>
      </div>
    </dl>

    <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/article.css?220222_230717>
    <article>
      <h1><a href="">技術書籍をシンタックスハイライトする話</a></h1>
      <section>
        <h2 id="intro"><a href="#intro">Intro</a></h2>
        <p>「連載するけど、代わりにコードはハイライトさせてほしい」
        <p>それが Web+DB Press 編集長に俺が出した条件だった。
      </section>
      <section>
        <h2 id="技術書籍のシンタックスハイライト"><a href="#技術書籍のシンタックスハイライト">技術書籍のシンタックスハイライト</a></h2>
        <p>エンジニアは普段から、エディタ上でも、リポジトリ上でも、ブログ上でも、何かしらハイライトされたコードを見ている。
        <p>そんなエンジニアに向けて書かれた技術書籍でありながら、書籍のコードがハイライトされているのはみたことがない。
        <p>「<strong>技術書籍がシンタックスハイライトされてないのは、出版社の怠慢だ</strong>」
        <p>と、割と本気で思っていた。そして、今でも思っている。
        <p>特にページを跨ぐような長いサンプルコードを、単色で印刷されても、正直読む気になれない。
        <p>白黒だからしょうがないと思われているかもしれないが、白黒だとしても、文字の太さ、濃淡、フォントの微妙な使いわけなどで、かなり見やすくすることができる。
        <p>今はやっていないが、このブログでも、印刷用のレイアウトで白黒ハイライトを実装していた時期がある。これを実証するためだった。
        <p>もっと言えば、カラーで印刷された技術書籍や電子書籍でも、コードは単色だったりする。
        <p>技術的に不可能なわけではない、InDesign 上で特定の行だけ強調するといったことは、編集者によって行われている。
        <p>編集者が全てちまちま色をつけるのは無理でも、シンタックスハイライトのライブラリなどを連携して、自動的に InDesign 上に反映すればできるはずだ。
        <p>口だけではなく手を動かして実証する良い機会だと思い、ハイライトされている俺のブログの白黒印刷を見せながら、目黒の居酒屋で俺は編集長を説得した。
      </section>
      <section>
        <h2 id="webdb-の編集ツール"><a href="#webdb-の編集ツール">Web+DB の編集ツール</a></h2>
        <p>なぜ、一介の著者が編集にまで口を出せるのか? と思うかもしれない。
        <p>実は、Web+DB の中で特に編集長が使ってた執筆用のツール群は、歴代の著者達が(執筆をサボる口実に)作ってきたものだったりする。
        <p>元々編集長は、原稿中に本誌では絶対出てこない <code translate=no>□</code> とか <code translate=no>☆</code> みたいな全角記号でマークアップし、それを InDesign のタグに変換するみたいなフローを取っていた。
        <p>その独自記法で原稿を書くのが気にくわなかった(という体で執筆をサボりたかった)当時の著者達は、Markdown をパースして独自記法で吐き出すライブラリを作っていた。
        <p>それは、歴代の著者によってメンテが継がれ、機能やテストが足されたり、プレビュー用の UI が Heroku にデプロイされたりしていた。
        <p>その変換ライブラリに手を入れ、コードブロックを抜き出し、ハイライターに噛ませて、良い感じに InDesign 用に変更できれば、いけるだろうという算段があった。
      </section>
      <section>
        <h2 id="md2indesign"><a href="#md2indesign">md2indesign</a></h2>
        <p>ところが、実際に変換ライブラリを直すとなると、いろいろな問題があった。
        <p>もう具体的にどんな問題があったのかは全く思い出せない。覚えてるのは、2019 年にもなって Perl なんか読みたくもなく書きたくもないと思ったことくらいだ。
        <p>そもそも、Markdown -&gt; 独自記法 -&gt; InDesign だったが、どう考えても Markdown -&gt; InDesign で良い。
        <p>Markdown のパーサも、Syntax Highlight のライブラリも、なるべく広く使われてメンテされているものがいい。
        <p>そんなこんなで、気づいたら md2indesign を、このブログのビルドコードをベースに書き始めていた。
      </section>
      <section>
        <h2 id="indesign-記法"><a href="#indesign-記法">InDesign 記法</a></h2>
        <p>もうほとんど覚えてないが、InDesign の記法は、タグ付け記法でありながら、我々が慣れ親しんだ HTML や XML のようなタグ付けマークアップとちょっと違う。
        <p>確かにタグはついてるんだが、基本行頭にしかない。というか、行頭じゃないといけないので、インデントはタグの前じゃなく後に行う。そして、タグは閉じない。
        <p>途中でスタイルを変えたい場合に、Inline タグのようなものがある。こちらは閉じる。ただ、それはスイッチでしかなく、閉じたら閉じる前のスタイルに戻るわけではない。
        <p>とかだった気がする。手元に残ってたサンプル片を見ると、そんな感じだったように思う。
        <link rel=stylesheet property=stylesheet type=text/css href="https://www.jxck.io/assets/css/pre.css?220404_030403">
        <pre><code translate=no>&lt;UNICODE-MAC&gt;
&lt;ParaStyle:h1&gt;This is Title
&lt;ParaStyle:p&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
&lt;ParaStyle:p&gt;inline styles are  &lt;CharStyle:em&gt;italic&lt;CharStyle:&gt; also &lt;CharStyle:em&gt;italic&lt;CharStyle:&gt; are supported.
&lt;ParaStyle:h4&gt;go
&lt;ParaStyle:code-go:code/sample.go&gt;&lt;CharStyle:CodeKeyword&gt;package&lt;CharStyle:&gt; &lt;CharStyle:CodeName&gt;main&lt;CharStyle:&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;&lt;CharStyle:CodeKeyword&gt;import&lt;CharStyle:&gt; &lt;CharStyle:CodeLiteralString&gt;&quot;fmt&quot;&lt;CharStyle:&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;&lt;CharStyle:CodeKeyword&gt;func&lt;CharStyle:&gt; &lt;CharStyle:CodeName&gt;main&lt;CharStyle:&gt;&lt;CharStyle:CodePunctuation&gt;()&lt;CharStyle:&gt; &lt;CharStyle:CodePunctuation&gt;{&lt;CharStyle:&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;	&lt;CharStyle:CodeComment&gt;// this is sample code&lt;CharStyle:&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;	&lt;CharStyle:CodeName&gt;fmt&lt;CharStyle:&gt;&lt;CharStyle:CodeOperator&gt;.&lt;CharStyle:&gt;&lt;CharStyle:CodeName&gt;Println&lt;CharStyle:&gt;&lt;CharStyle:CodePunctuation&gt;(&lt;CharStyle:&gt;&lt;CharStyle:CodeLiteralString&gt;&quot;Hello World&quot;&lt;CharStyle:&gt;&lt;CharStyle:CodePunctuation&gt;)&lt;CharStyle:&gt;
&lt;ParaStyle:code-go:code/sample.go&gt;&lt;CharStyle:CodePunctuation&gt;}&lt;CharStyle:&gt;</code></pre>
        <p>Markdown 系のライブラリで HTML に変換して、そのタグの名前を置換すればできそう、という想定は早々に崩れた。
        <p>InDesign は持ってなかったし使ったこともないので、編集長からもらった仕様書と、サンプルアウトプットを見ながら、Markdown パーサが吐く AST を元にこれを吐くエンコーダをまるっと書いた。
      </section>
      <section>
        <h2 id="webdb-のハイライト"><a href="#webdb-のハイライト">Web+DB のハイライト</a></h2>
        <p>実際に誌面上でハイライトした結果がこれだ。物理本でも、もちろんこのように刷られている。
        <p>
          <picture>
            <source type=image/avif srcset=./syntax-highlighted-wdpress.avif?240313_215035>
            <source type=image/webp srcset=./syntax-highlighted-wdpress.webp?240313_215035>
            <img loading=lazy decoding=async src=./syntax-highlighted-wdpress.jpeg?240313_215035 alt="シンタックスハイライトされた誌面" width=3504 height=1826>
          </picture>
        </p>
        <p>このとき書いた原稿は、コードブロックが多いタイプの記事ではなかったので、メリットがわかりにくいかもしれない。気づいた人も少なかっただろう。
        <p>デザインの詰めも実装も甘すぎて、HTTP はほぼハイライトされてない。モードを変えればフルカラーハイライトもできたはずだが、Web+DB は紙と電子で同じ PDF なので結局使ってない。
        <p>それでもこの時確かに、雑誌の中で俺の原稿だけだったが、待望の「技術書籍をハイライトする」は、誰にも気づかれることもなく、Web+DB Press 上で実現していた。
      </section>
      <section>
        <h2 id="名物編集長"><a href="#名物編集長">名物編集長</a></h2>
        <p>今は知らないが、ちょっと前まで Git + Markdown な執筆自体ができない会社も多くあった。そんな中 Web+DB は、こういう筆者のわがままをかなり聞いてくれる稀有な雑誌だった。
        <p>編集長は Git をいち早く覚え(著者人に仕込まれ?)、Markdown をデフォルトにし、普段開発どっぷりな著者たちが持ってくるツールやワークフローに色々付き合ってくれた。
        <p>俺が、その前に Go の入門特集を頼まれた時は、「ペアプロならぬ、ペア執筆を試してみたい!」ということで、俺の家に編集長を呼び出して「編集長に Go を教える」というペア執筆を経て書いたものだった。
        <p>Web+DB でも他の編集者だったらそこまではなかったか、単に編集長がいい人だっただけな気がしてきた。いじられキャラで、人たらしで、めちゃくちゃいい人で優秀な編集長だった。
      </section>
      <section>
        <h2 id="まだ情熱はある"><a href="#まだ情熱はある">まだ、情熱はある</a></h2>
        <p>この後、フルタイムで働きつつ md2indesign と原稿執筆の並行を行うには可処分時間がどう考えても足りず、それっきりになってしまった。
        <p>ただ、個人としては「<em>技術書籍をハイライトする</em>」をまだ諦めたわけではない。
        <p>様々な著者が書くあらゆるコードを、すべからくパースして雑誌全体をハイライトするのは、俺一人でできる範囲を超えていた。俺が関わる本以外も全てハイライトされるには、どこかがアプライアンスを出してくれないと無理だろう。
        <p>それでも、「自分が書いた原稿とコード」だけに絞れば個人でも可能だ。
        <p>今書いている書籍をいつか本にする機会があったら、その時にハイライトを入れられるように、Markdown のパーサは全部自前で書き直し、こういう用途に応用できるようなプラグインシステムも入れてる。出てくるコードも、Web 開発でよく使うものくらいに絞れば、それ以外の言語にしか出てこないトークンは無視できる。
        <p>もうすでにそういう製品があったり、知らないだけで全コードがハイライトされた書籍を出してる出版社はあるのかもしれないが、そういう本を少なくとも自分は見てない。
        <p>そして、少なくとも自分の関われる範囲では、紙は白黒ハイライト、電子はフルカラーハイライト、そんな書籍を作る準備をあれからずっと続けている。
      </section>
      <section>
        <h2 id="outro"><a href="#outro">Outro</a></h2>
        <p>今 Web+DB に執筆するなら、もう少し上手くハイライトできたかもしれない。次があったら、ChatGPT 駆動執筆しようとか、言ってたかもなぁ。
        <p>しかし、もうその機会も無くなってしまった。残念だ。というかもう編集長じゃないのか。お疲れ様でした。
        <p>単に育ててもらったとか、お世話になった以上の、何かを勝手に感じている。
        <p>Web+DB Press が休刊と聞いて、ふと色々思い出した。廃刊ではなく休刊なら、また読める日が来るのを楽しみにしてます。
      </section>
    </article>
  </main>
  <hr>

  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/footer.css?201223_011131>
  <footer>
    <p class=copyright><small>Copyright &copy; 2016 <a href=https://jxck.io>Jxck</a>. All Rights Reserved.</small> See <small><a href=https://jxck.io/policies/site.html>Site Policy</a> and <a href=https://jxck.io/policies/privacy.html>Privacy Policy</a>.</small></p>
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5a6d3cda77d54761ba2f5c3f56d17ceb"}'></script><!-- End Cloudflare Web Analytics -->
  </footer>

</body>
</html>
