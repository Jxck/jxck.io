<!DOCTYPE html>
<html lang=ja>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1">

  <link rel=author    href=https://jxck.io/humans.txt>
  <link rel=manifest  href=/manifest.webmanifest>
  <link rel=alternate href=/feeds/atom.xml type=application/atom+xml title=blog.jxck.io>
  <link rel=canonical href=https://blog.jxck.io/entries/2016-01-27/new-blog-start.html>

  <link rel=preload as=script href=https://www.jxck.io/assets/js/prism.js?210115_215132>
  <link rel=preload as=script href=https://www.jxck.io/assets/js/main.js?230728_230731>

  <script defer src=https://www.jxck.io/assets/js/prism.js?210115_215132></script>
  <script defer src=https://www.jxck.io/assets/js/main.js?230728_230731></script>

  <link rel=icon type=image/svg+xml sizes=any href=https://blog.jxck.io/assets/img/jxck.svg>
  <link rel=icon type=image/png sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.png>
  <link rel=icon type=image/png sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.png>
  <link rel=icon type=image/png sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.png>
  <link rel=icon type=image/png sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.png>
  <link rel=icon type=image/png sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.png>

  <link rel=icon type=image/webp sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.webp>
  <link rel=icon type=image/webp sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.webp>
  <link rel=icon type=image/webp sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.webp>
  <link rel=icon type=image/webp sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.webp>
  <link rel=icon type=image/webp sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.webp>

  <link rel=apple-touch-icon type=image/png sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.png>
  <link rel=apple-touch-icon type=image/png sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.png>
  <link rel=apple-touch-icon type=image/png sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.png>
  <link rel=apple-touch-icon type=image/png sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.png>
  <link rel=apple-touch-icon type=image/png sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.png>

  <link rel=apple-touch-icon type=image/webp sizes=120x120 href=https://blog.jxck.io/assets/img/jxck.120x120.webp>
  <link rel=apple-touch-icon type=image/webp sizes=300x300 href=https://blog.jxck.io/assets/img/jxck.300x300.webp>
  <link rel=apple-touch-icon type=image/webp sizes=600x600 href=https://blog.jxck.io/assets/img/jxck.600x600.webp>
  <link rel=apple-touch-icon type=image/webp sizes=1200x1200 href=https://blog.jxck.io/assets/img/jxck.1200x1200.webp>
  <link rel=apple-touch-icon type=image/webp sizes=3000x3000 href=https://blog.jxck.io/assets/img/jxck.3000x3000.webp>

  <meta name=author              content=Jxck>
  <meta name=description         content="長いこと はてな blog をメインにし、他にも Qiita や Tumblr を使って色々書いて来たが、そろそろ自分のドメインに全部集約していこうかと思う。">
  <meta name=keywords            content="web,blog">
  <meta name=theme-color         content=#000000>

  <meta property=og:type         content=article>
  <meta property=og:url          content=https://blog.jxck.io/entries/2016-01-27/new-blog-start.html>
  <meta property=og:title        content="Blog を移転しました | blog.jxck.io">
  <meta property=og:site_name    content=blog.jxck.io>
  <meta property=og:description  content="長いこと はてな blog をメインにし、他にも Qiita や Tumblr を使って色々書いて来たが、そろそろ自分のドメインに全部集約していこうかと思う。">
  <meta property=og:image        content=https://blog.jxck.io/assets/img/jxck.600x600.png>

  <meta name="Hatena::Bookmark" content="nocomment">
  <link rel="author" href="http://www.hatena.ne.jp/Jxck/" />


  <script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://blog.jxck.io"
    },
    "headline": "Blog を移転しました | blog.jxck.io",
    "image": [
      "https://www.jxck.io/assets/img/jxck.png",
      "https://logo.jxck.io/jxck.1200x1200.png"
    ],
    "datePublished": "2016-01-27T08:00:00+08:00",
    "dateModified": "2024-05-28T08:00:00+08:00",
    "author": {
      "@type": "Person",
      "name": "Jxck",
      "image": "https://blog.jxck.io/assets/img/jxck.png"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Jxck",
      "logo": {
        "@type": "ImageObject",
        "url": "https://logo.jxck.io/jxck.120x120.png",
        "height": 120,
        "width": 120
      }
    },
    "description": "長いこと はてな blog をメインにし、他にも Qiita や Tumblr を使って色々書いて来たが、そろそろ自分のドメインに全部集約していこうかと思う。"
  }
  </script>

  <title>Blog を移転しました | blog.jxck.io</title>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/body.css?240701_012822>
</head>
<body>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/header.css?230926_134917>
  <header>
    <nav>
      <ul>
        <li><a href=https://blog.jxck.io      ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/blog.svg?160301_215351   title=blog   alt="blog logo" class=logo></a>
        <li><a href=/search                   ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/search.svg?190421_130410 title=search alt=search></a>
        <li><a href=.                         ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/up.svg?160831_002319     title=up     alt="move to parent directory"></a>
        <li><a href=/feeds/atom.xml           ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/rss.svg?160227_124312    title=rss    alt="rss feed"></a>
        <li><a href=https://jxck.io/humans.txt><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/humans.svg?160831_002319 title=humans alt=huamns.txt></a>
        <li><a href=https://jxck.io           ><img width=30 height=30 loading=eager src=https://www.jxck.io/assets/img/jxck.svg?190123_200004   title=jxck   alt="jxck logo" class=logo></a>
      </ul>
    </nav>
  </header>

  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/markdown.css?220304_061221>
  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/main.css?201223_011131>
  <main>
    <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/info.css?240713_033306>
    <dl class=info>
      <div><dt>created_at</dt><dd><time class=created_at datetime=2016-01-27>2016-01-27</time></dd></div>
      <div><dt>updated_at</dt><dd><time class=updated_at datetime=2024-05-28>2024-05-28</time></dd></div>
      <div>
        <dt>tags</dt>
        <dd>
          <nav class=tags>
            <ul>
              <li><a href="/tags#web">web</a>
              <li><a href="/tags#blog">blog</a>
            </ul>
          </nav>
        </dd>
      </div>
      <div>
        <dt>toc</dt>
        <dd>
          <button popovertarget="toc">open</button>
          <nav id=toc popover=manual>
            <h2>ToC</h2>
            <button popovertarget="toc" popovertargetaction="hide">❌</button>
            <ol>
              <li><a href="#intro">Intro</a>
              <li><a href="#motivation">motivation</a>
              <li><a href="#test-section">test section</a>
              <ol>
                <li><a href="#heading-section-3">heading section 3</a>
                <ol>
                  <li><a href="#heading-section-4">heading section 4</a>
                </ol>
                <li><a href="#リストスタイル">リストスタイル</a>
                <li><a href="#定義リスト">定義リスト</a>
              </ol>
              <li><a href="#引用">引用</a>
              <li><a href="#テーブル">テーブル</a>
              <li><a href="#image">Image</a>
              <li><a href="#video">Video</a>
              <ol>
                <li><a href="#サンプルコード">サンプルコード</a>
              </ol>
            </ol>
          </nav>
        </dd>
      </div>
    </dl>

    <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/article.css?220222_230717>
    <article>
      <h1><a href="">Blog を移転しました</a></h1>
      <section>
        <h2 id="intro"><a href="#intro">Intro</a></h2>
        <p>長いこと <a href="https://jxck.hatenablog.com/" target=_blank>はてな blog</a> をメインにし、他にも <a href="https://qiita.com/jxck_" target=_blank>Qiita</a> や <a href="http://jxck.tumblr.com/" target=_blank>Tumblr</a> を使って色々書いて来たが、そろそろ自分のドメインに全部集約していこうかと思う。
      </section>
      <section>
        <h2 id="motivation"><a href="#motivation">motivation</a></h2>
        <p>最近、メディア系は独自のサイトを持つよりも、 Medium などのサービス経由で流入してもらわないと辛いという話をよく聞くので、その意味では完全に逆行しているかもしれない。
        <p>しかし、別に PV を稼ぐためにブログを書いているわけでもないので、むしろ技術的にも自分で色々試せる自由な環境を持ち、特定のサービスに依存せずやってみるのも良いと考える。
        <p>むしろ、ドメイン自体は結構前に取っていたので、遅すぎるくらいなのだが、やっと重い腰を上げた。
        <p>まだ作り途中であり、一気に移行するのは難しいが、徐々に作りながらやっていこうと思う。
      </section>
      <section>
        <h2 id="test-section"><a href="#test-section">test section</a></h2>
        <p>以降は、本サイトのマークアップやスタイルをテストするためのセクションである。
        <p>対応している記法を列挙し、挙動を確認する。
        <section>
          <h3 id="heading-section-3"><a href="#heading-section-3">heading section 3</a></h3>
          <p>ここは <code translate=no>&lt;h3&gt;</code> セクションである。
          <section>
            <h4 id="heading-section-4"><a href="#heading-section-4">heading section 4</a></h4>
            <p>ここは <code translate=no>&lt;h4&gt;</code> セクションである。
          </section>
        </section>
        <section>
          <h3 id="リストスタイル"><a href="#リストスタイル">リストスタイル</a></h3>
          <p>リストスタイルは 2 つある
          <ol>
            <li>ordered list
            <li>un-ordered list
          </ol>
          <p>それぞれは使うタグが違う
          <ul>
            <li>ここはリストスタイルである
            <li>unordered list は <code translate=no>&lt;ul&gt;</code> を用いて表現する
            <li>
              <code translate=no>&lt;li&gt;</code> の前には markdown と同じく <code translate=no>-</code> を表示する
              <ul>
                <li>入れ子にも対応している
              </ul>
            </li>
            <li>
              しかし 2 段階以上の深さは使わないようにする
              <ul>
                <li>リストの中で引用もできる
                <li>
                  <blockquote>
                    <p>ここは <code translate=no>&lt;blockquote&gt;</code> です
                  </blockquote>
                </li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h3 id="定義リスト"><a href="#定義リスト">定義リスト</a></h3>
          <p>定義リストは <code translate=no>&lt;dl&gt;</code> を用いて表現する
          <dl>
            <div>
              <dt>定義リスト(description list)
              <dd><code translate=no>&lt;dl&gt;</code> を用いる
            </div>
            <div>
              <dt>定義(description term)
              <dd><code translate=no>&lt;dt&gt;</code> を用いる
            </div>
            <div>
              <dt>説明(description details)
              <dd><code translate=no>&lt;dd&gt;</code> を用いる
            </div>
          </dl>
        </section>
      </section>
      <section>
        <h2 id="引用"><a href="#引用">引用</a></h2>
        <p>引用は <code translate=no>&lt;blockquote&gt;</code> を用いて表現する。
        <blockquote cite="https://example.com">
          <p>他のサイトなどから引用する場合は <code translate=no>&lt;blockquote&gt;</code> を用いて表現する。
          <p>複数行あると <code translate=no>&lt;p&gt;</code> に展開される
          <p>引用元の URL は <code translate=no>&lt;cite&gt;</code> を用いてマークアップする
          <p>&mdash; <cite><a href="https://example.com" target=_blank>example.com</a></cite>
        </blockquote>
      </section>
      <section>
        <h2 id="テーブル"><a href="#テーブル">テーブル</a></h2>
        <p>テーブルは <code translate=no>&lt;table&gt;</code> タグを用いて表現する。
        <link rel=stylesheet property=stylesheet type=text/css href="https://www.jxck.io/assets/css/table.css?220306_111358">
        <figure>
          <figcaption>キャプションは必須</figcaption>
          <table>
            <thead>
              <tr>
                <th class=align-left>範囲</th>
                <th class=align-right>文字数</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class=align-left>基本ラテン文字</td>
                <td class=align-right>94</td>
              </tr>
              <tr>
                <td class=align-left>CJK 記号と句読点</td>
                <td class=align-right>11</td>
              </tr>
              <tr>
                <td class=align-left>ひらがな</td>
                <td class=align-right>81</td>
              </tr>
              <tr>
                <td class=align-left>カタカナ</td>
                <td class=align-right>83</td>
              </tr>
              <tr>
                <td class=align-left>半角形と全角形</td>
                <td class=align-right>0</td>
              </tr>
              <tr>
                <td class=align-left>常用漢字</td>
                <td class=align-right>2136</td>
              </tr>
              <tr>
                <td class=align-left>記号</td>
                <td class=align-right>1</td>
              </tr>
              <tr>
                <td class=align-left>不要文字</td>
                <td class=align-right>- 23</td>
              </tr>
              <tr>
                <td class=align-left>追加更新</td>
                <td class=align-right>13</td>
              </tr>
              <tr>
                <td class=align-left>合計</td>
                <td class=align-right>2396</td>
              </tr>
            </tbody>
          </table>
        </figure>
        <p>半角の例
        <figure>
          <figcaption>webp と圧縮率</figcaption>
          <table>
            <thead>
              <tr>
                <th class=align-left>file type</th>
                <th class=align-right>size</th>
                <th class=align-right>ratio</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class=align-left>.webp</td>
                <td class=align-right>9474</td>
                <td class=align-right>100%</td>
              </tr>
              <tr>
                <td class=align-left>.webp.gz</td>
                <td class=align-right>2609</td>
                <td class=align-right>28%</td>
              </tr>
              <tr>
                <td class=align-left>.webp.br</td>
                <td class=align-right>2544</td>
                <td class=align-right>27%</td>
              </tr>
            </tbody>
          </table>
        </figure>
      </section>
      <section>
        <h2 id="image"><a href="#image">Image</a></h2>
        <p>画像は <code translate=no>&lt;picture&gt;</code> タグを用いて表現する。
        <p>
          <picture>
            <source type=image/avif srcset=jxck.avif?231208_001215>
            <source type=image/webp srcset=jxck.webp?240313_215035>
            <img loading=lazy decoding=async src=jxck.png?210331_115006 alt="jxck" title="jxck logo" width=300 height=300>
          </picture>
        </p>
        <p>必ず <code translate=no>.webp</code> も提供する必要がある。
        <p>webp の推奨は以下
        <link rel=stylesheet property=stylesheet type=text/css href="https://www.jxck.io/assets/css/pre.css?220404_030403">
        <pre class=sh data-code=sh><code translate=no class=language-sh>$ cwebp -q 40 img.png -o img.webp</code></pre>
      </section>
      <section>
        <h2 id="video"><a href="#video">Video</a></h2>
        <p>markdown 上は画像と同じ記法で、拡張子が <code translate=no>mp4</code> の場合は <code translate=no>&lt;video&gt;</code> で展開する。
        <p>
          <video title="dummy video" width=1000 height=2000 controls playsinline>
            <source type=video/mp4 src=dummy_video.mp4?231116_154951>
            <source type=video/webm src=dummy_video.webm?231116_154951>
          </video>
        </p>
        <p>必ず <code translate=no>.mp4</code>、<code translate=no>.webm</code> 両方を提供する必要がある。
        <p>QuickTime で screen record を取り gif 的に表示するなら推奨は以下。
        <pre class=sh data-code=sh><code translate=no class=language-sh># メタデータを消し、 frame rate を 24 にし、Audio を消す
$ ffmpeg -i video.mov -map_metadata -1 -r 24 -an video.webm
$ ffmpeg -i video.mov -map_metadata -1 -r 24 -an video.mp4</code></pre>
        <section>
          <h3 id="サンプルコード"><a href="#サンプルコード">サンプルコード</a></h3>
          <p>インラインの場合は <code translate=no>&lt;code&gt;</code> タグを用いて表現する。
          <p>コードブロックの場合は <code translate=no>&lt;pre&gt;</code> と <code translate=no>&lt;code&gt;</code> を用いて表現する。
          <pre class=http data-code=http><code translate=no class=language-http># デフォルトリクエスト
GET / HTTP/1.1
Host: example.com
User-Agent: browser
Accept-Encoding: br, gz
Accept-Language: ja-JP</code></pre>
          <pre class=js data-code=js><code translate=no class=language-js>class Test {
  constructor(arg) {
    this.arg = arg
  }
  print() {
    console.log(this.arg)
  }
}

const test = new Test(&apos;hello&apos;)
test.print() // hello</code></pre>
          <p>ファイルからコードを読むこともできる。以下ハイライトテスト用。
          <pre><code translate=no>no tag</code></pre>
          <pre class=text data-code=text><code translate=no class=language-text>hello world</code></pre>
          <pre class=js data-code=js data-path=sample.js><code translate=no class=language-js>class Test {
  constructor(arg) {
    this.arg = arg
  }
  print() {
    console.log(this.arg)
  }
}

const test = new Test(&apos;hello&apos;)
test.print() // hello</code></pre>
          <pre class=rb data-code=rb data-path=../2016-02-17/test.rb><code translate=no class=language-rb>#!/usr/bin/env ruby
`rm *.gz`
`rm result`
`touch result`
(1..10)
  .map { |i| i * 10 }
  .each { |i| `time -v -a -o result zopfli --i#{i} -c loading-css-over-http2.html &gt; loading-css-over-http2.html.#{i}.gz` }</code></pre>
          <pre class=js data-code=js data-path=../2016-10-27/searchparams.js><code translate=no class=language-js>const URL = require(&apos;url&apos;).URL;

const u = new URL(&apos;https://jxck.io?log=warn&amp;lang=ja&apos;);
const searchParams = u.searchParams;
searchParams.get(&apos;log&apos;) // &quot;warn&quot;
searchParams.getAll(&apos;log&apos;) // [&quot;warn&quot;]
searchParams.delete(&apos;log&apos;) // undefined
searchParams.has(&apos;log&apos;) // false
searchParams.append(&apos;debug&apos;, true) // undefined
searchParams.toString() // &quot;lang=ja&amp;debug=true&quot;

for ([k, v] of searchParams) {
  console.log(k, v);
  // lang ja
  // debug true
}</code></pre>
          <pre class=js data-code=js data-path=../2016-10-27/url-ext.js><code translate=no class=language-js>const URL = require(&apos;url&apos;).URL;

// 日本語ドメイン
const jp = new URL(&apos;https://じゃっく.jp&apos;);
console.log(jp);
// URL {
//   href: https://xn--y8jr7a5i.jp/
//   protocol: https:
//   hostname: xn--y8jr7a5i.jp
//   pathname: /
// }

// IPv6
const ipv6 = new URL(&apos;https://[::1]/&apos;);
console.log(ipv6);
// URL {
//   href: https://[::1]/
//   protocol: https:
//   hostname: [::1]
//   pathname: /
// }

// 日本語
const ja = new URL(&apos;https://example.com/ぱす?きー=ばりゅー&apos;);
console.log(ja);
// URL {
//   href: https://example.com/%E3%81%B1%E3%81%99?%E3%81%8D%E3%83%BC=%E3%81%B0%E3%82%8A%E3%82%85%E3%83%BC
//   protocol: https:
//   hostname: example.com
//   pathname: /%E3%81%B1%E3%81%99
//   search: ?%E3%81%8D%E3%83%BC=%E3%81%B0%E3%82%8A%E3%82%85%E3%83%BC
// }</code></pre>
          <pre class=js data-code=js data-path=../2016-10-27/url.js><code translate=no class=language-js>const URL = require(&apos;url&apos;).URL;

const u = new URL(&apos;https://jxck:password@blog.jxck.io/path/to/entry?log=true&amp;lang=ja#main&apos;);
console.log(u);
// URL {
//   href: https://jxck:password@blog.jxck.io/path/to/entry?log=true&amp;lang=ja#main
//   protocol: https:
//   username: jxck
//   password: --------
//   hostname: blog.jxck.io
//   pathname: /path/to/entry
//   search: ?log=true&amp;lang=ja
//   hash: #main
// }</code></pre>
          <pre class=js data-code=js data-path=../2016-12-12/random.js><code translate=no class=language-js>self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.log(&apos;install&apos;);
  e.registerForeignFetch({
    scopes: [&apos;/random/number&apos;], // or self.registration.scope to handle everything
    origins: [&apos;*&apos;] // or [&apos;https://client1.com&apos;] to limit the remote origins
  });
});

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.log(&apos;activate&apos;);
});

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  console.log(&apos;fetch&apos;);
});

self.addEventListener(&apos;foreignfetch&apos;, (e) =&gt; {
  console.log(&apos;foreignfetch&apos;);
  e.respondWith(
    fetch(e.request)
      .then((response) =&gt; {
        console.log(&apos;online response&apos;);
        return {
          response,
          origin: e.origin // Make this a CORS response
        };
      })
      .catch(() =&gt; {
        console.log(&apos;offline response&apos;);
        return {
          response: new Response(Math.floor(Math.random()*100)),
          origin: e.origin // Make this a CORS response
        };
      })
  );
});</code></pre>
          <pre class=js data-code=js data-path=../2016-12-12/worker.js><code translate=no class=language-js>const CACHE = &quot;foreign-fetch&quot;
self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.info(e.type, e)
  e.waitUntil((async () =&gt; {
    const cache = await caches.open(CACHE)
    return cache.addAll([
      &apos;.&apos;,
      &apos;./index.html&apos;,
      &apos;./worker.js&apos;
    ])
  })())
})

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(e.type, e)
  e.waitUntil(self.clients.claim())
})

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  console.info(e.type, e.request)
  e.respondWith((async () =&gt; {
    const cache = await caches.open(CACHE)
    const cached = await cache.match(e.request)
    console.log({cached})
    return cached || fetch(e.request)
  })())
})</code></pre>
          <pre class=js data-code=js data-path=../2017-07-10/ee.js><code translate=no class=language-js>callback = console.log.bind(console)
process.on(&apos;foo&apos;, callback)
process.emit(&apos;foo&apos;, &apos;bar&apos;)
// bar
process.removeListener(&apos;foo&apos;, callback)</code></pre>
          <pre class=js data-code=js data-path=../2017-07-10/et.js><code translate=no class=language-js>callback = console.log.bind(console)
$div = document.createElement(&apos;div&apos;)
$div.addEventListener(&apos;foo&apos;, callback)
$div.dispatchEvent(new CustomEvent(&apos;foo&apos;, {detail:&apos;bar&apos;}))
// CustomEvent {type: &quot;foo&quot;, detail: &apos;bar&apos;...
$div.removeEventListener(&apos;foo&apos;, callback)</code></pre>
          <pre class=js data-code=js data-path=../2017-07-10/timer-ee.js><code translate=no class=language-js>EventEmitter = require(&apos;events&apos;)
class Timer extends EventEmitter {
  constructor(interval) {
    super()
    setInterval(() =&gt; {
      this.emit(&apos;tick&apos;, &apos;tick&apos;)
    }, interval)
  }
}

timer = new Timer(100)
timer.on(&apos;tick&apos;, console.log.bind(console))</code></pre>
          <pre class=js data-code=js data-path=../2017-07-10/timer-et.js><code translate=no class=language-js>class Timer extends EventTarget {
  constructor(interval) {
    super()
    setInterval(() =&gt; {
      this.dispatchEvent(new CustomEvent(&apos;tick&apos;))
    }, interval)
  }
}

timer = new Timer(100)
timer.addEventListener(&apos;tick&apos;, console.log.bind(console))</code></pre>
          <pre class=js data-code=js data-path=../2017-07-19/aborting-fetch.js><code translate=no class=language-js>function main() {
  // AbortController class が追加される
  const controller = new AbortController()

  // キャンセルを通知するための siganl が取得できる
  const signal = controller.signal

  startSpinner()

  // signal を第二引数に渡す
  fetch(url, {signal})
    .then((res) =&gt; {
      // レスポンスの処理
    })
    .catch((err) =&gt; {
      if (err.name == &apos;AbortError&apos;) {
        // 中断の場合の処理
        return
      }
      // 中断以外のエラー処理
      console.error(err)
    })
    .then(() =&gt; {
      // finally 相当
      stopSpinner()
    })


  // fetch が 1000ms 超えたらコントローラ経由で中断する
  setTimeout(() =&gt; {
    controller.abort()
  }, 1000)
}</code></pre>
          <pre class=js data-code=js data-path=../2017-07-19/long-task.js><code translate=no class=language-js>class LongTask extends EventTarget {
  start() {
    //...
  }
  stop() {
    //...
  }
}

function longTaskPromise({signal}) {
  return new Promise((resolve, reject) =&gt; {
    // 処理の Promise 化
    let longTask = new LongTask()
    longTask.addEventListener(&apos;data&apos;, resolve)
    longTask.addEventListener(&apos;error&apos;, reject)
    longTask.start()

    // abort signal のハンドリング
    signal.addEventListener(&apos;abort&apos;, () =&gt; {
      longTask.stop()
      reject(new DOMException(&apos;Aborted&apos;, &apos;AbortError&apos;))
    })
  })
}


function main() {
  // AbortController class が追加される
  const controller = new AbortController()

  // キャンセルを通知するための siganl が取得できる
  const signal = controller.signal

  startSpinner()

  // signal を第二引数に渡す
  longTaskPromise({signal})
    .then((result) =&gt; {
      // 結果の正常処理
    })
    .catch((err) =&gt; {
      if (err.name == &apos;AbortError&apos;) {
        // 中断の場合の処理
        return
      }
      // 中断以外のエラー
      console.error(err)
    })
    .then(() =&gt; {
      // finally
      stopSpinner()
    })


  // fetch が 1000ms 超えたらコントローラ経由で中断する
  setTimeout(() =&gt; {
    controller.abort()
  }, 1000)
}</code></pre>
          <pre class=js data-code=js data-path=../2017-07-19/race-fetch.js><code translate=no class=language-js>const controlle = new AbortController()
const signal = controller.signal

// 同じリソースを複数のミラーに問い合わせて
// 一番早く返ってきたやつだけ使いたい的な例
Promise.race([
  fetch(url, {signal}),
  fetch(mirror1, {signal}),
  fetch(mirror2, {signal}),
  fetch(mirror3, {signal}),
]).then((res) =&gt; {
  // 最初のレスポンス
  console.log(res)
  // そのままでは残りの fetch も走るので
  // それらを止める。
  controller.abort()
}).catch((err) =&gt; {
  if (err.name == &apos;AbortError&apos;) {
    // ここに来るのは race が終わる前に Abort した場合
    // race が終わった後の abort はここに来ない
    return
  }
  // race の失敗
  console.error(err)
})</code></pre>
          <pre class=erlang data-code=erlang data-path=../2018-01-14/erlang-record-to-map.erl><code translate=no class=language-erlang>#!/usr/bin/env escript
-module(main).

-mode(compile).
-compile(export_all).

-define(Log(A),                (fun(P) -&gt; io:format(&quot;[~p:~p#~p] ~p~n&quot;,     [?MODULE, ?FUNCTION_NAME, ?LINE, P]), P end)(A)).

-define(RtoM(Name, Record), lists:foldl(fun({I, E}, Acc) -&gt; Acc#{E =&gt; element(I, Record) } end, #{}, lists:zip(lists:seq(2, (record_info(size, Name))), (record_info(fields, Name))))).

-record(point, {x, y}).
main(_) -&gt;
    Point = #point{x=10, y=20},
    ?Log(Point),
    ?Log(?RtoM(point, Point)),
    ok.</code></pre>
          <pre class=rb data-code=rb data-path=../2018-03-27/ct.rb><code translate=no class=language-rb>#!/usr/bin/env ruby
require &quot;base64&quot;
require &quot;json&quot;
require &quot;net/http&quot;
require &quot;openssl&quot;
require &quot;pp&quot;
require &quot;uri&quot;

# ./ct.rb ct.googleapis.com/pilot ./path-to-letsencrypt-live/fullchain.pem
main(*ARGV)

def get_proof_by_hash(host, cert, tree_size, timestamp)
  der = cert.to_der

  blob = [
    0, # prefix (uint8)
    0, # v1 (uint8)
    0, # timestamped_entry (uint8)
    timestamp, # timestamp (uint32)
    0, # x509_entry (uint16)

    # length in 24bit
    (der.size &gt;&gt; 16) &amp; 255,
    (der.size &gt;&gt;  8) &amp; 255,
    (der.size &gt;&gt;  0) &amp; 255,

    der, # der (binary)

    0, # extension (uint16)
  ].pack(&quot;C3Q&gt;nC3a*n&quot;)

  sha256 = OpenSSL::Digest::SHA256.digest(blob)
  base64 = Base64.encode64(sha256).chomp
  param = URI.encode_www_form(&quot;hash&quot; =&gt; base64, &quot;tree_size&quot; =&gt; tree_size)

  ## Debug
  # puts &quot;timestamp = #{timestamp}&quot;
  # puts &quot;tree_size = #{tree_size}&quot;
  # puts &quot;sha256 = #{OpenSSL::Digest::SHA256.hexdigest(blob)}&quot;
  # puts &quot;base64 = #{base64}&quot;

  uri = URI.parse(&quot;https://#{host}/ct/v1/get-proof-by-hash?#{param}&quot;)
  request = Net::HTTP::Get.new(uri)
  response = Net::HTTP.start(uri.hostname, uri.port, {use_ssl: true}) do |http|
    http.request(request)
  end

  puts &quot;\e[0;31m$ curl &apos;#{uri}&apos; | jq .\e[0m&quot;
  pp JSON.parse(response.body)
end

def get_sth(host)
  uri    = URI.parse(&quot;https://#{host}/ct/v1/get-sth&quot;)
  json   = Net::HTTP.get(uri)
  result = JSON.parse(json)

  puts &quot;\e[0;31m$ curl &apos;#{uri}&apos; | jq .\e[0m&quot;
  pp result
end

def add_chain(host, chain)
  uri = URI.parse(&quot;https://#{host}/ct/v1/add-chain&quot;)
  request = Net::HTTP::Post.new(uri)
  request.content_type = &quot;application/json&quot;

  str = chain.map{|cert|
    cert
      .to_pem
      .gsub(&quot;-----BEGIN CERTIFICATE-----\n&quot;, &quot;&quot;)
      .gsub(&quot;-----END CERTIFICATE-----\n&quot;, &quot;&quot;)
      .gsub(&quot;\n&quot;, &quot;&quot;)
  }

  request.body = JSON.dump({
    &quot;chain&quot; =&gt; str
  })

  response = Net::HTTP.start(uri.hostname, uri.port, {use_ssl: true}) do |http|
    http.request(request)
  end

  puts &lt;&lt;-EOS
\e[0;31m$ curl -H &apos;Content-Type:application/json&apos; \\
       -d &apos;{ &quot;chain&quot;: #{str} }&apos; \\
       #{uri} | jq . \e[0m
EOS

  pp JSON.parse(response.body)
end

def main(host = &quot;ct.googleapis.com/pilot&quot;, pemfile)
  puts &quot;host = #{host}&quot;
  puts &quot;pemfile = #{pemfile}&quot;
  chain = File.read(pemfile)
    .split(&quot;-----END CERTIFICATE-----\n&quot;)
    .map{|str| str + &quot;-----END CERTIFICATE-----\n&quot;}
    .map{|str| OpenSSL::X509::Certificate.new(str) }

  tree_size = get_sth(host)[&quot;tree_size&quot;]
  puts &quot;&quot;
  timestamp = add_chain(host, chain)[&quot;timestamp&quot;]
  puts &quot;&quot;
  get_proof_by_hash(host, chain[0], tree_size, timestamp)
end</code></pre>
          <pre class=shell data-code=shell data-path=../2018-03-27/ct.sh><code translate=no class=language-shell>curl -H &apos;Content-Type:application/json&apos; \
     -d &apos;{ &quot;chain&quot;: [&quot;MIIFvTCCBKWgAwIBAgISA6/EsoaosazyV8VTiLTZMzBzMA0GCSqGSIb3DQEBCwUAMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQDExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xODAzMDYwNjA5MDZaFw0xODA2MDQwNjA5MDZaMBIxEDAOBgNVBAMTB2p4Y2suaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7UnbgMfyQOVAqOp9oNjcoHZ2p0H0sUkFERYzZ2VXXJRkg7QzFrZTAP7jdxw/HEhkMJTMNlX59cvEyxiEbgNqTLYQjwSP1Ibgtkjzq2EPlm2SsFkq6vwbuydZA31HQa2vEYqZzo9RUG69T4URUotmtZBTWqW5w8m9l9xwCuInzOxS8990rVW27FiWtSF+4HI/mBTzHAX/w1dJRaT9ESrWJnmKYcYCBayCswEfp9b6uOgNWASZBd67lKE2AfE0FDdgKclElttBbvK8Kl2TNpCzwRwwzt54Bt9AFt8MZr4p4SKUjuj5GkcFrlnvyESbXJuyZwnnUCNkbxxYP0LfsgfmnAgMBAAGjggLTMIICzzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFMnlleIsgD60xDmW8Pz/yWKKPjk4MB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMwYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9yZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9yZy8wgd0GA1UdEQSB1TCB0oINYWRtaW4uanhjay5pb4ILYXBpLmp4Y2suaW+CDGJsb2cuanhjay5pb4INZmlsZXMuanhjay5pb4IHanhjay5pb4IMbGFiMi5qeGNrLmlvggxsYWJzLmp4Y2suaW+CDGxvZ28uanhjay5pb4INcmFpbHMuanhjay5pb4IScmVwb3J0LXVyaS5qeGNrLmlvggtzZnUuanhjay5pb4INc2xpZGUuanhjay5pb4IMc3BlYy5qeGNrLmlvggp3cy5qeGNrLmlvggt3d3cuanhjay5pbzCB/gYDVR0gBIH2MIHzMAgGBmeBDAECATCB5gYLKwYBBAGC3xMBAQEwgdYwJgYIKwYBBQUHAgEWGmh0dHA6Ly9jcHMubGV0c2VuY3J5cHQub3JnMIGrBggrBgEFBQcCAjCBngyBm1RoaXMgQ2VydGlmaWNhdGUgbWF5IG9ubHkgYmUgcmVsaWVkIHVwb24gYnkgUmVseWluZyBQYXJ0aWVzIGFuZCBvbmx5IGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgQ2VydGlmaWNhdGUgUG9saWN5IGZvdW5kIGF0IGh0dHBzOi8vbGV0c2VuY3J5cHQub3JnL3JlcG9zaXRvcnkvMA0GCSqGSIb3DQEBCwUAA4IBAQA6Tnb6wxUgQE7mnf8N+5PgIzC5ebxjGps/I2ppEqnvuAECdrkWySdqPDG8e7lyuyxzzav6FTFUb3y8EwDrdT+UDquewpv6TxoP1NcnuMRhpjV41Y/otxRW53+Fz+g+Ub4XTnrJmK98aq8vzyMpvkWhHPMfs2xRsIkNH6L/T0h+8AL7MpKLiuqiy9SA4COVjNLX5Z2ZyK/xPaNhfJ1jv7vs/fvIGNLtJ7sCwVa54r8OycNVd1nj9zVFmtJ554S3fRBNFI5vZNJJw4npN1/q1bQ1B7oo8U1pLunDxqhvNHO247WDRVBeCvJLuZGZJc4g35W97iUTVVbwPLVfK4o82MOD&quot;, &quot;MIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMTDkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0NlowSjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMTGkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EFq6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8SMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0Z8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWAa6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIGCCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNvbTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9kc3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAwVAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcCARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAzMDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwuY3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsFAAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJouM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/wApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwuX4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlGPfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6KOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==&quot;] }&apos; \
     https://ct.googleapis.com/pilot/ct/v1/add-chain | jq .

curl &apos;https://ct.googleapis.com/pilot/ct/v1/get-sth&apos; | jq .

curl &apos;https://ct.googleapis.com/pilot/ct/v1/get-proof-by-hash?hash=odRjuexWzJ36zh8XavhDEZaUhoAv9yxRF4zEyKZiVVg%3D&amp;tree_size=237363285&apos; | jq .</code></pre>
          <pre class=go data-code=go data-path=../2018-03-27/main.go><code translate=no class=language-go>package main

import (
	&quot;bytes&quot;
	&quot;crypto/sha256&quot;
	&quot;encoding/base64&quot;
	&quot;encoding/binary&quot;
	&quot;encoding/pem&quot;
	&quot;io/ioutil&quot;
	&quot;log&quot;
	&quot;os&quot;
)

func init() {
	log.SetFlags(log.Lshortfile)
}

var p = log.Println

func main() {
	// fullchain.pem を読み込む
	path := os.Args[1]
	file, _ := ioutil.ReadFile(path)

	// チェインの各証明書をデコード
	var chain []*pem.Block
	for {
		var block *pem.Block
		block, file = pem.Decode(file)
		if block == nil {
			break
		}
		chain = append(chain, block)
	}

	// enum { v1(0), (255) } Version;
	type Version uint8
	var v1 Version = 0

	// enum { timestamped_entry(0), (255) } MerkleLeafType;
	type MerkleLeafType uint8
	var timestamped_entry MerkleLeafType = 0

	// timestamp
	var timestamp uint64 = 1520467826187

	// enum { x509_entry(0), precert_entry(1), (65535) } LogEntryType;
	type LogEntryType uint16
	var x509_entry LogEntryType = 0

	buf := bytes.NewBuffer([]byte{})

	// prefix
	var prefix uint8 = 0
	binary.Write(buf, binary.BigEndian, prefix)

	// MerkleTreeLeaf
	binary.Write(buf, binary.BigEndian, v1)
	binary.Write(buf, binary.BigEndian, timestamped_entry)

	// TimestampedEntry
	binary.Write(buf, binary.BigEndian, timestamp)
	binary.Write(buf, binary.BigEndian, x509_entry)

	// opaque ASN.1Cert&lt;1..2^24-1&gt;;
	// 24bit length
	var certlen uint32 = uint32(len(chain[0].Bytes))
	binary.Write(buf, binary.BigEndian, uint8(certlen&gt;&gt;16&amp;255))
	binary.Write(buf, binary.BigEndian, uint8(certlen&gt;&gt;8&amp;255))
	binary.Write(buf, binary.BigEndian, uint8(certlen&gt;&gt;0&amp;255))
	// cert
	binary.Write(buf, binary.BigEndian, chain[0].Bytes)

	// opaque CtExtensions&lt;0..2^16-1&gt;;
	var extension uint16 = 0
	binary.Write(buf, binary.BigEndian, extension)
	p(len(buf.Bytes()), buf.Bytes())

	// MTH({d(0)}) = SHA-256(0x00 || d(0)).
	// prefix=0x00 はすでに加えてある
	hash := sha256.Sum256(buf.Bytes())
	log.Printf(&quot;%x&quot;, hash)

	p(base64.URLEncoding.EncodeToString(hash[:]))

	// この hash をつけてリクエスト
	p(&quot;curl &apos;https://ct.googleapis.com/rocketter/ct/v1/get-proof-by-hash?hash=xxx&amp;tree_size=yyy&apos;&quot;)
}</code></pre>
          <pre class=http data-code=http data-path=../2020-01-18/1.http><code translate=no class=language-http>Content-Security-Policy: default-src &apos;self&apos; report-uri https://report-uri.example.com</code></pre>
          <pre class=http data-code=http data-path=../2020-01-18/2.http><code translate=no class=language-http>Content-Security-Policy: default-src &apos;self&apos; report-to=default-endpoint
Feature-Policy: syncxhr &apos;none&apos; report-to=default-endpoint
NEL: {&quot;report-to&quot;: &quot;default-endpoint&quot;, &quot;max-age&quot;: 2592000}
Report-To: {
             &quot;group&quot;: &quot;default-endpoint&quot;,
             &quot;max-age&quot;: &quot;36000&quot;,
             &quot;endpoints&quot;: [
               {&quot;url&quot;: &quot;https://report-uri.example.com&quot;},
               {&quot;url&quot;: &quot;https://report-uri2.example.com&quot;}
             ]
           }</code></pre>
          <pre class=js data-code=js data-path=../2020-01-18/3.js><code translate=no class=language-js>const observer = new ReportingObserver((reports, observer) =&gt; {
  const message = JSON.stringify(reports)
  navigator.sendBeacon(&quot;https://report-uri.example.com&quot;, message)
});

observer.observe();</code></pre>
          <pre class=http data-code=http data-path=../2020-01-18/4.http><code translate=no class=language-http>Report-To: {
             &quot;max_age&quot;: 36000,
             &quot;endpoints&quot;: [
               {
                 &quot;url&quot;: &quot;https://reports.example.com/default-endpoint&quot;
               }
             ]
           },
           {
             &quot;group&quot;: &quot;csp-endpoint&quot;,
             &quot;include_subdomains&quot;: true,
             &quot;max_age&quot;: 36000,
             &quot;endpoints&quot;: [
               {
                 &quot;url&quot;: &quot;https://reports.example.com/csp-endpoint1&quot;,
                 &quot;priority&quot;: 1,
                 &quot;weight&quot;: 50
               },
               {
                 &quot;url&quot;: &quot;https://reports.example.com/csp-endpoint2&quot;,
                 &quot;priority&quot;: 1,
                 &quot;weight&quot;: 50
               },
               {
                 &quot;url&quot;: &quot;https://failover.example.com/csp-endpoint&quot;,
                 &quot;priority&quot;: 2
               }
             ]
           }</code></pre>
          <pre class=http data-code=http data-path=../2020-01-18/5.http><code translate=no class=language-http>Content-Security-Policy: default-src &apos;self&apos; report-to=csp-endpoint
Feature-Policy: syncxhr &apos;none&apos; report-to=default
NEL: {&quot;report-to&quot;: &quot;default&quot;, &quot;max-age&quot;: 2592000}
Report-To: {
             &quot;group&quot;: &quot;default&quot;,
             &quot;max_age&quot;: 36000,
             &quot;endpoints&quot;: [{ &quot;url&quot;: &quot;https://reports.example.com/default-endpoint&quot; }]
           },
           {
             &quot;group&quot;: &quot;csp-endpoint&quot;,
             &quot;endpoints&quot;: [{ &quot;url&quot;: &quot;https://reports.example.com/csp-endpoint&quot; }]
           }</code></pre>
          <pre class=http data-code=http data-path=../2020-01-18/6.http><code translate=no class=language-http>POST /default-endpoint HTTP/1.1
Host: reports.example.com
Content-Type: application/reports+json
Content-Length: 999

[
  {
    &quot;type&quot;: &quot;csp&quot;,
    &quot;url&quot;: &quot;https://example.com/csp.html/&quot;,
    &quot;body&quot;: {...}
  },
  {
    &quot;type&quot;: &quot;nel&quot;,
    &quot;url&quot;: &quot;https://example.com/nel.html/&quot;,
    &quot;body&quot;: {...}
  },
  {
    &quot;type&quot;: &quot;hpkp&quot;,
    &quot;url&quot;: &quot;https://example.com/hpkp.html/&quot;,
    &quot;body&quot;: {...}
  },
]</code></pre>
          <pre class=js data-code=js data-path=../2020-01-18/7.js><code translate=no class=language-js>{
  &quot;type&quot;: &quot;deprecation&quot;,
    &quot;url&quot;: &quot;https://blog.jxck.io/entries/2018-05-15/webauthentication-api.html&quot;,
    &quot;body&quot;: {
      &quot;id&quot;: &quot;ChromeLoadTimesWasAlternateProtocolAvailable&quot;,
      &quot;anticipatedRemoval&quot;: null,
      &quot;message&quot;: &quot;chrome.loadTimes() is deprecated, instead use standardized API: nextHopProtocol in Navigation Timing 2. https://www.chromestatus.com/features/5637885046816768.&quot;,
      &quot;sourceFile&quot;: &quot;chrome-extension://mpbpobfflnpcgagjijhmgnchggcjblin/content.js&quot;,
      &quot;lineNumber&quot;: 5,
      &quot;columnNumber&quot;: 19
    }
}

{
  &quot;type&quot;: &quot;deprecation&quot;,
    &quot;age&quot;: 27,
    &quot;url&quot;: &quot;https://example.com/&quot;,
    &quot;user_agent&quot;: &quot;Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0&quot;,
    &quot;body&quot;: {
      &quot;id&quot;: &quot;websql&quot;,
      &quot;anticipatedRemoval&quot;: &quot;1/1/2020&quot;,
      &quot;message&quot;: &quot;WebSQL is deprecated and will be removed in Chrome 97 around January 2020&quot;,
      &quot;sourceFile&quot;: &quot;https://example.com/index.js&quot;,
      &quot;lineNumber&quot;: 1234,
      &quot;columnNumber&quot;: 42
    }
}</code></pre>
          <pre class=cpp data-code=cpp data-path=../2020-08-15/pick-best-image-candidate.cpp><code translate=no class=language-cpp>// device_scale_factor = DPR
// source_size = sizes attr value
static ImageCandidate PickBestImageCandidate(float device_scale_factor, float source_size, Vector&lt;ImageCandidate&gt;&amp; image_candidates, Document* document = nullptr) {
  const float kDefaultDensityValue = 1.0;
  bool ignore_src = false;

  // 画像がなければ無視
  if (image_candidates.IsEmpty()) {
    return ImageCandidate();
  }

  // 画像ごとに表示領域に対する密度を計算(1.0 だとフィット)
  // http://picture.responsiveimages.org/#normalize-source-densities
  for (ImageCandidate&amp; image : image_candidates) {
    if (image.GetResourceWidth() &gt; 0) {
      float gensity = (float)image.GetResourceWidth() / source_size;
      image.SetDensity(gensity);
      ignore_src = true;
    } else if (image.Density() &lt; 0) {
      image.SetDensity(kDefaultDensityValue);
    }
  }

  // 密度でソート
  std::stable_sort(image_candidates.begin(), image_candidates.end(), CompareByDensity);

  Vector&lt;ImageCandidate*&gt; de_duped_image_candidates;
  float prev_density = -1.0;

  // 同じ密度を省く?
  for (ImageCandidate&amp; image : image_candidates) {
    if (image.Density() != prev_density &amp;&amp; (!ignore_src || !image.SrcOrigin())) {
      de_duped_image_candidates.push_back(&amp;image);
    }
    prev_density = image.Density();
  }

  // SelectionLogic で画像を選択
  // Save Data してる場合は一番小さいの、ここでは無視
  // unsigned winner = blink::WebNetworkStateNotifier::SaveDataEnabled() &amp;&amp; base::FeatureList::IsEnabled(blink::features::kSaveDataImgSrcset) ? 0 : SelectionLogic(de_duped_image_candidates, device_scale_factor);
  unsigned winner = SelectionLogic(de_duped_image_candidates, device_scale_factor);
  DCHECK_LT(winner, de_duped_image_candidates.size());
  winner = AvoidDownloadIfHigherDensityResourceIsInCache(de_duped_image_candidates, winner, document);

  float winning_density = de_duped_image_candidates[winner]-&gt;Density();
  // 16. If an entry b in candidates has the same associated ... pixel density
  // as an earlier entry a in candidates,
  // then remove entry b
  while ((winner &gt; 0) &amp;&amp; (de_duped_image_candidates[winner - 1]-&gt;Density() == winning_density))
    --winner;

  return *de_duped_image_candidates[winner];
}</code></pre>
          <pre class=cpp data-code=cpp data-path=../2020-08-15/selection-logic.cpp><code translate=no class=language-cpp>// device_scale_factor = DPR
static unsigned SelectionLogic(Vector&lt;ImageCandidate*&gt;&amp; image_candidates, float device_scale_factor) {
  unsigned i = 0;

  for (; i &lt; image_candidates.size() - 1; ++i) {
    unsigned next = i + 1;
    float next_density;
    float current_density;
    float geometric_mean;

    next_density = image_candidates[next]-&gt;Density();

    // next の密度が DSF より小さいならまだ先をみる必要
    if (next_density &lt; device_scale_factor) {
      continue;
    }

    // next の密度が DSF より大きい、つまり表示に十分だとわかった
    // そこで curr とのどっちを表示するかを考える
    current_density = image_candidates[i]-&gt;Density();

    // そのために幾何平均をまず取る
    geometric_mean  = sqrt(current_density * next_density);

    // curr が DPR より低くても、 DPR が 1 なら next を使う
    // もしくは
    // Geo が DSF より小さいなら next
    // (そうでないなら curr)
    if (((current_density &lt; device_scale_factor) &amp;&amp; (device_scale_factor &lt;= 1.0)) || (geometric_mean &lt;= device_scale_factor)) {
      return next;
    }
    break;
  }
  return i;
}</code></pre>
          <pre class=html data-code=html data-path=../2016-04-24/claim.html><code translate=no class=language-html>&lt;!DOCTYPE html&gt;
&lt;meta charset=utf-8&gt;
&lt;title&gt;Service Worker&lt;/title&gt;

&lt;h1&gt;Service Worker&lt;/h1&gt;

&lt;a href=test&gt;test&lt;/a&gt;

&lt;input id=test type=button value=test&gt;

&lt;script src=master.js&gt;&lt;/script&gt;</code></pre>
          <pre class=html data-code=html data-path=../2016-04-24/push.html><code translate=no class=language-html>&lt;!DOCTYPE html&gt;
&lt;meta charset=utf-8&gt;
&lt;title&gt;Service Worker Push Demo | labs.jxck.io&lt;/title&gt;

&lt;link rel=manifest href=manifest.json&gt;

&lt;script src=master.js&gt;&lt;/script&gt;

&lt;h1&gt;Push DEMO&lt;/h1&gt;</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/backgroundsync-master.js><code translate=no class=language-js>// master.js
navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  return navigator.serviceWorker.ready;
}).then((registration) =&gt; {
  // register sync
  document.getElementById(&apos;button&apos;).addEventListener(&apos;click&apos;, () =&gt; {
    registration.sync.register(&apos;sync-data&apos;).then(() =&gt; {
      console.log(&apos;sync registered&apos;);
    }).catch(console.error.bind(console));
  });
}).catch(console.error.bind(console));</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/backgroundsync-worker.js><code translate=no class=language-js>// worker.js
self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.info(&apos;install&apos;, e);
  e.waitUntil(skipWaiting());
});

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(&apos;activate&apos;, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;sync&apos;, (e) =&gt; {
  console.log(&apos;sync&apos;, e);
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/claim-master.js><code translate=no class=language-js>console.log(&apos;master&apos;);

document.getElementById(&apos;button&apos;).addEventListener(&apos;click&apos;, () =&gt; {
  fetch(&apos;/test&apos;);
});

navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  console.log(registration);
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/claim-worker.js><code translate=no class=language-js>console.info(&apos;worker&apos;);

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(&apos;activate&apos;, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  let path = new URL(e.request.url).pathname;
  console.log(path);
  if (path === &apos;/test&apos;) {
    e.respondWith(new Response(&apos;test&apos;));
  }
  return;
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/controllerchange-master.js><code translate=no class=language-js>console.log(&apos;master&apos;);

let controllerChange = new Promise((resolve, reject) =&gt; {
  navigator.serviceWorker.addEventListener(&apos;controllerchange&apos;, () =&gt; {
    resolve(navigator.serviceWorker.controller);
  });
});

navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  return navigator.serviceWorker.ready;
}).then(() =&gt; {
  if (navigator.serviceWorker.controller) {
    return navigator.serviceWorker.controller;
  }
  return controllerChange;
}).then((controller) =&gt; {
  console.log(controller);
  fetch(&apos;/test&apos;);
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/controllerchange-worker.js><code translate=no class=language-js>console.info(&apos;worker&apos;);

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(&apos;activate&apos;, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  let path = new URL(e.request.url).pathname;
  console.info(path);
  if (path === &apos;/test&apos;) {
    e.respondWith(new Response(&apos;test&apos;));
  }
  return;
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/push-master.js><code translate=no class=language-js>&apos;use strict&apos;;
let p = console.log.bind(console);

navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  return navigator.serviceWorker.ready;
}).then((registration) =&gt; {
  return registration.pushManager.subscribe({ userVisibleOnly: true });
}).then((subscription) =&gt; {
  console.log(subscription);

  const endpoint = subscription.endpoint;
  const auth = subscription.getKey(&apos;auth&apos;);
  const p256dh = subscription.getKey(&apos;p256dh&apos;);

  const userAuth = btoa(String.fromCharCode(...new Uint8Array(auth)));
  const userPublicKey = btoa(String.fromCharCode(...new Uint8Array(p256dh)));

  // send to server
  const body = {endpoint, userAuth, userPublicKey};

  console.log(body);

}).catch(console.error.bind(console));</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/push-worker.js><code translate=no class=language-js>self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.info(&apos;install&apos;, e);
  e.waitUntil(self.skipWaiting());
});

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(&apos;activate&apos;, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;push&apos;, (e) =&gt; {
  console.info(&apos;push&apos;, e);
  const message = e.data.text();

  e.waitUntil(self.registration.showNotification(&apos;title&apos;, {
    body: message,
    icon: &apos;/service-worker/push/jxck.png&apos;,
    tag:  &apos;push-demo&apos;,
  }));
});

self.addEventListener(&apos;notificationclick&apos;, (e) =&gt; {
  console.info(&apos;notificationclick&apos;, e.notification.tag);
  e.notification.close();
  const URL = &apos;https://labs.jxck.io/service-worker/push/&apos;;
  e.waitUntil(clients.matchAll({
      type: &apos;window&apos;
    }).then((windowClients) =&gt; {
      let target = windowClients.filter((client) =&gt; {
        return client.url === URL;
      });
      console.log(target, target.length);
      if (target.length &gt; 0) {
        // タブが開いているので、最初のものにフォーカスする
        return target[0].focus();
      }
      // タブが開いてないので開く
      return clients.openWindow(URL);
  }));
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/push.js><code translate=no class=language-js>&apos;use strict&apos;;

let push = require(&apos;web-push&apos;);

const GCM_API_KEY = &apos;*******&apos;;
push.setGCMAPIKey(GCM_API_KEY);

const data = {
  &quot;endpoint&quot;: &quot;********&quot;,
  &quot;userAuth&quot;: &quot;********&quot;,
  &quot;userPublicKey&quot;: &quot;******&quot;
}

push.sendNotification(data.endpoint, {
  payload:       &apos;push test for service worker&apos;,
  userAuth:      data.userAuth,
  userPublicKey: data.userPublicKey,
})
.then((result) =&gt; {
  console.log(result);
})
.catch((err) =&gt; {
  console.error(&apos;fail&apos;, err);
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/update-master.js><code translate=no class=language-js>console.log(&apos;master&apos;);

navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  registration.addEventListener(&apos;updatefound&apos;, (e) =&gt; {
    console.info(&apos;update&apos;, e);
  });

  return navigator.serviceWorker.ready;
}).then((registration) =&gt; {
  setInterval(() =&gt; {
    console.log(&apos;update()&apos;);
    registration.update();
  }, 1000);
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/update-worker.js><code translate=no class=language-js>console.info(&apos;worker&apos;);

const ver = 1;

self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.info(` install${ver}`, e);
  e.waitUntil(skipWaiting());
});

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(` activate${ver}`, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  let path = new URL(e.request.url).pathname;
  console.info(path);
  if (path.indexOf(&apos;test&apos;) &gt; -1) {
    e.respondWith(new Response(&apos;test&apos;));
  }
  return;
});

self.addEventListener(&apos;push&apos;, () =&gt; {
  self.registration.update();
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/updatefound-master.js><code translate=no class=language-js>console.log(&apos;master&apos;);

navigator.serviceWorker.register(&apos;worker.js&apos;).then((registration) =&gt; {
  registration.addEventListener(&apos;updatefound&apos;, (e) =&gt; {
    console.info(&apos;update&apos;, e);
  });
  return navigator.serviceWorker.ready;
});</code></pre>
          <pre class=js data-code=js data-path=../2016-04-24/updatefound-worker.js><code translate=no class=language-js>console.info(&apos;worker&apos;);

const ver = 1;

self.addEventListener(&apos;install&apos;, (e) =&gt; {
  console.info(` install${ver}`, e);
  e.waitUntil(skipWaiting());
});

self.addEventListener(&apos;activate&apos;, (e) =&gt; {
  console.info(` activate${ver}`, e);
  e.waitUntil(self.clients.claim());
});

self.addEventListener(&apos;fetch&apos;, (e) =&gt; {
  let path = new URL(e.request.url).pathname;
  console.info(path);
  if (path === &apos;/service-worker/updatefound/test&apos;) {
    e.respondWith(new Response(&apos;test&apos;));
  }
  return;
});</code></pre>
          <pre translate=no>
          <code>
          <span class="token atrule     ">.token.atrule     </span>
          <span class="token attr-name  ">.token.attr-name  </span>
          <span class="token attr-value ">.token.attr-value </span>
          <span class="token bold       ">.token.bold       </span>
          <span class="token boolean    ">.token.boolean    </span>
          <span class="token builtin    ">.token.builtin    </span>
          <span class="token cdata      ">.token.cdata      </span>
          <span class="token char       ">.token.char       </span>
          <span class="token class-name ">.token.class-name </span>
          <span class="token comment    ">.token.comment    </span>
          <span class="token constant   ">.token.constant   </span>
          <span class="token deleted    ">.token.deleted    </span>
          <span class="token doctype    ">.token.doctype    </span>
          <span class="token entity     ">.token.entity     </span>
          <span class="token entity     ">.token.entity     </span>
          <span class="token function   ">.token.function   </span>
          <span class="token important  ">.token.important  </span>
          <span class="token important  ">.token.important  </span>
          <span class="token inserted   ">.token.inserted   </span>
          <span class="token italic     ">.token.italic     </span>
          <span class="token keyword    ">.token.keyword    </span>
          <span class="token namespace  ">.token.namespace  </span>
          <span class="token number     ">.token.number     </span>
          <span class="token operator   ">.token.operator   </span>
          <span class="token parameter  ">.token.parameter  </span>
          <span class="token prolog     ">.token.prolog     </span>
          <span class="token property   ">.token.property   </span>
          <span class="token punctuation">.token.punctuation</span>
          <span class="token regex      ">.token.regex      </span>
          <span class="token selector   ">.token.selector   </span>
          <span class="token string     ">.token.string     </span>
          <span class="token symbol     ">.token.symbol     </span>
          <span class="token tag        ">.token.tag        </span>
          <span class="token url        ">.token.url        </span>
          <span class="token variable   ">.token.variable   </span>
          </code>
          </pre>
        </section>
      </section>
    </article>
  </main>
  <hr>

  <link rel=stylesheet property=stylesheet type=text/css href=https://www.jxck.io/assets/css/footer.css?201223_011131>
  <footer>
    <p class=copyright><small>Copyright &copy; 2016 <a href=https://jxck.io>Jxck</a>. All Rights Reserved.</small> See <small><a href=https://jxck.io/policies/site.html>Site Policy</a> and <a href=https://jxck.io/policies/privacy.html>Privacy Policy</a>.</small></p>
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "5a6d3cda77d54761ba2f5c3f56d17ceb"}'></script><!-- End Cloudflare Web Analytics -->
  </footer>

</body>
</html>
